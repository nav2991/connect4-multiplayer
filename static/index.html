<!DOCTYPE html>
<html>
<head>
  <title>Connect 4 Game</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="title-container">
    <h1 class="title"><span class="connect">CONNECT</span> <span class="four">4</span></h1>
  </div>
  
  <div class="lobby-container">
    <div class="lobby-header">
      <button class="create-room-btn">
        <span class="plus-symbol">+</span>
        Create Room
      </button>
      <h2 class="lobby-title">Player Lobby</h2>
    </div>
    
    <div class="lobby-separator"></div>
    
    <div class="rooms-list" id="rooms-list">
      <!-- Room numbers and join buttons will be added here dynamically -->
    </div>
  </div>

  <script>
    const socket = new WebSocket(`ws://${window.location.host}/ws`);
    
    socket.onopen = () => {
      console.log("ðŸŸ¢ WebSocket connected");
    };
    
    socket.onmessage = (event) => {
      console.log("ðŸ“© Message from server:", event.data);
      const data = JSON.parse(event.data);
      
      if (data.type === 'room_list') {
        console.log("Received room list:", data.rooms);
        // Clear existing rooms and add all rooms from server
        document.getElementById('rooms-list').innerHTML = '';
        data.rooms.forEach(roomId => addRoom(roomId));
      } else if (data.type === 'join_success') {
        window.location.href = `/game?room=${data.room_id}&player=${data.player}`;
      } else if (data.type === 'join_error') {
        alert(data.message);
      }
    };
    
    socket.onclose = () => {
      console.log("ðŸ”´ WebSocket disconnected");
    };
    
    function addRoom(roomId) {
      const roomsList = document.getElementById('rooms-list');
      
      const roomBox = document.createElement('div');
      roomBox.className = 'room-box';
      roomBox.innerHTML = `
        <div class="room-info">
          <span class="room-number">Room ${roomId}</span>
        </div>
        <button class="join-room-btn" onclick="joinRoom('${roomId}')">Join</button>
      `;
      
      roomsList.appendChild(roomBox);
    }
    
    function joinRoom(roomId) {
      socket.send(JSON.stringify({
        action: 'join_room',
        room_id: roomId
      }));
    }
    
    document.querySelector('.create-room-btn').addEventListener('click', function() {
      socket.send(JSON.stringify({
        action: 'create_room'
      }));
    });
  </script>
</body>
</html>
